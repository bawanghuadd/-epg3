# 工单详情页面实现说明

## 概述

工单详情页面 (`pages/engineer/workorder-detail.uvue`) 提供了完整的订单信息展示和交互功能,是工程师查看工单详细信息的主要界面。

## 页面特性

### 1. 顶部导航栏
- **返回按钮**: 点击返回到工单列表页
- **页面标题**: 显示"订单详情"
- **更多操作**: 提供分享订单、投诉举报等扩展功能

### 2. 订单状态卡片
采用醒目的橙红色渐变背景,突出显示:
- **订单状态**: 当前订单的状态文本
- **预估时间**: 预计完成时间或剩余时长
- **视觉设计**: 使用渐变色和阴影效果,提升视觉层次

### 3. 服务进度时间轴
采用垂直时间轴设计,清晰展示订单流转过程:
- **已完成步骤**: 绿色圆点标识
- **进行中步骤**: 红色圆点带脉冲动画效果
- **待完成步骤**: 灰色圆点标识
- **时间信息**: 每个步骤都显示对应的时间戳

典型流程:
1. 订单已确认
2. 工程师已出发
3. 已到达现场
4. 服务中
5. 客户验收
6. 完成支付

### 4. 服务信息
- **订单编号**: 唯一订单标识符
- **服务类型**: 以标签形式展示(如"电工服务"、"计件工资")

### 5. 客户信息
- **联系人**: 客户姓名
- **联系电话**: 
  - 显示脱敏的手机号
  - 点击电话图标可直接拨打
- **服务地址**: 
  - 显示详细地址
  - 点击定位图标打开地图导航

### 6. 服务时间
- **预约时间**: 客户预约的服务时间段
- **实际时间**: 实际开始服务的时间(服务开始后显示)

### 7. 费用明细
清晰展示费用构成:
- **服务费用**: 基础服务费
- **材料费用**: 额外材料费(如有)
- **优惠金额**: 折扣或优惠(如有)
- **合计**: 最终总金额,红色加粗显示

### 8. 订单备注
显示客户的特殊要求或备注信息

### 9. 底部操作栏
- **取消订单**: 仅在待确认状态显示
- **联系客服**: 可选择电话客服或在线客服

## 核心功能

### 1. 页面跳转
从工单列表页点击"查看详情"跳转:
```javascript
// 在 workorders.uvue 中
function handleViewDetail(workorder) {
  uni.navigateTo({
    url: `/pages/engineer/workorder-detail?id=${workorder.id}`
  })
}
```

### 2. 拨打客户电话
```javascript
function callCustomer() {
  uni.showModal({
    title: '拨打电话',
    content: `确认拨打 ${orderDetail.value.customer.phone}?`,
    success: (res) => {
      if (res.confirm) {
        uni.makePhoneCall({
          phoneNumber: orderDetail.value.customer.phone.replace(/\*/g, '')
        })
      }
    }
  })
}
```

### 3. 地图导航
```javascript
function navigateToLocation() {
  uni.openLocation({
    latitude: 39.9942,
    longitude: 116.4764,
    name: '望京SOHO',
    address: orderDetail.value.customer.address
  })
}
```

### 4. 取消订单
```javascript
function handleCancel() {
  uni.showModal({
    title: '取消订单',
    content: '确认要取消这个订单吗?',
    success: (res) => {
      if (res.confirm) {
        // TODO: 调用取消订单API
        // 取消成功后返回列表页
      }
    }
  })
}
```

### 5. 联系客服
提供两种联系方式:
- **电话客服**: 拨打400服务热线
- **在线客服**: 跳转到在线客服聊天(待开发)

## 数据结构

### orderDetail 对象
```javascript
{
  id: 订单ID,
  orderNo: '订单编号',
  status: '订单状态代码',
  statusText: '订单状态文本',
  estimatedTime: '预估完成时间',
  timeline: [
    {
      title: '步骤标题',
      time: '时间戳',
      completed: true/false,  // 是否完成
      active: true/false      // 是否为当前步骤
    }
  ],
  serviceTags: [
    { name: '标签名称', type: 'primary/secondary' }
  ],
  customer: {
    name: '客户姓名',
    phone: '联系电话',
    address: '服务地址'
  },
  serviceTime: {
    scheduled: '预约时间',
    actual: '实际时间'
  },
  pricing: {
    service: '服务费',
    material: '材料费',
    discount: '优惠金额',
    total: '总计'
  },
  note: '订单备注'
}
```

## UI设计特点

### 1. 颜色方案
- **主色调**: #E53935 (红色,用于强调和按钮)
- **渐变色**: #FF7043 → #FF5722 (状态卡片背景)
- **成功色**: #4CAF50 (已完成状态)
- **警告色**: #FF9800 (进行中状态)
- **文本色**: #333 (主要文本), #666 (次要文本), #999 (辅助文本)

### 2. 圆角和阴影
- **卡片圆角**: 24rpx
- **按钮圆角**: 12-16rpx
- **卡片阴影**: 0 8rpx 24rpx rgba(255, 87, 34, 0.3)

### 3. 间距规范
- **页面边距**: 32rpx
- **卡片间距**: 24rpx
- **内容间距**: 20-24rpx
- **行间距**: 12-16rpx

### 4. 动画效果
- **时间轴脉冲**: 当前进行中的步骤带有脉冲动画
```scss
@keyframes pulse {
  0%, 100% {
    box-shadow: 0 0 0 8rpx rgba(229, 57, 53, 0.15);
  }
  50% {
    box-shadow: 0 0 0 16rpx rgba(229, 57, 53, 0.1);
  }
}
```

## 响应式设计

### 安全区域适配
- 顶部导航栏适配刘海屏: `padding-top: calc(20rpx + env(safe-area-inset-top))`
- 底部操作栏适配底部横条: `padding-bottom: calc(20rpx + env(safe-area-inset-bottom))`

### 滚动区域
- 使用 `scroll-view` 实现内容滚动
- 底部留出足够空间(180rpx)避免被操作栏遮挡

## 后续开发计划

### 1. API 集成
- [ ] 对接订单详情查询接口
- [ ] 实现订单取消功能
- [ ] 接入客服系统

### 2. 功能增强
- [ ] 添加订单分享功能
- [ ] 实现投诉举报流程
- [ ] 支持订单评价
- [ ] 添加订单历史记录

### 3. 交互优化
- [ ] 添加页面加载动画
- [ ] 优化网络请求错误处理
- [ ] 实现下拉刷新
- [ ] 添加骨架屏

## 测试要点

### 1. 功能测试
- 页面正常加载和数据展示
- 返回按钮功能
- 拨打电话功能
- 地图导航功能
- 取消订单流程
- 联系客服功能

### 2. 兼容性测试
- 不同屏幕尺寸适配
- 安全区域显示
- iOS 和 Android 平台

### 3. 边界情况
- 网络异常处理
- 数据为空时的显示
- 非法订单ID处理

## 相关文件

- 页面文件: `/pages/engineer/workorder-detail.uvue`
- 路由配置: `/pages.json` (第92-98行)
- 工单列表页: `/pages/engineer/workorders.uvue`

## 更新日志

### 2025-11-24
- ✅ 创建订单详情页面
- ✅ 实现时间轴UI组件
- ✅ 完成费用明细展示
- ✅ 添加客户联系功能
- ✅ 实现地图导航功能

