# 工程师认证状态测试指南

## 📱 如何在微信开发者工具中查看不同认证状态的页面

### 方法一：使用测试页面（推荐）

我们创建了一个专门的测试页面，可以方便地切换和测试不同的认证状态。

#### 1. 访问测试页面

在微信开发者工具中，通过以下方式访问测试页面：

**方式A：直接在地址栏输入**
```
/pages/engineer/verify-test
```

**方式B：在任意页面的控制台执行**
```javascript
uni.navigateTo({
  url: '/pages/engineer/verify-test'
})
```

**方式C：添加到 pages.json（推荐）**

在 `pages.json` 中添加测试页面路由：

```json
{
  "path": "pages/engineer/verify-test",
  "style": {
    "navigationBarTitleText": "认证状态测试",
    "navigationStyle": "custom"
  }
}
```

然后就可以在编译模式中选择这个页面进行测试。

#### 2. 使用测试页面

测试页面提供了以下功能：

1. **查看当前认证状态**
   - 显示当前的认证状态（未认证/审核中/已认证/已拒绝）
   - 显示认证信息（如果有）

2. **切换认证状态**
   - 点击对应按钮即可切换到不同的认证状态
   - 状态会保存在本地存储中

3. **快速测试场景**
   - 场景1：新用户首次认证
   - 场景2：认证审核中
   - 场景3：认证通过
   - 场景4：认证被拒绝

4. **页面跳转测试**
   - 测试跳转到认证页面
   - 测试跳转到工程师首页
   - 测试认证守卫功能

### 方法二：使用控制台命令

在微信开发者工具的控制台中，可以直接执行以下命令来设置认证状态：

#### 设置为未认证
```javascript
uni.removeStorageSync('engineerVerifyStatus')
uni.removeStorageSync('engineerVerifyInfo')
console.log('已设置为未认证状态')
```

#### 设置为审核中
```javascript
uni.setStorageSync('engineerVerifyStatus', 'pending')
uni.setStorageSync('engineerVerifyInfo', {
  realName: '张三',
  phone: '13800138000',
  idCard: '320102199001011234',
  skills: ['电路维修', '智能家居'],
  experience: '3-5年',
  region: ['江苏省', '扬州市', '广陵区']
})
console.log('已设置为审核中状态')
```

#### 设置为已认证
```javascript
uni.setStorageSync('engineerVerifyStatus', 'approved')
uni.setStorageSync('engineerVerifyInfo', {
  realName: '张三',
  phone: '13800138000',
  idCard: '320102199001011234',
  skills: ['电路维修', '智能家居'],
  experience: '3-5年',
  region: ['江苏省', '扬州市', '广陵区'],
  verifyTime: '2025-11-20 10:30:00'
})
console.log('已设置为已认证状态')
```

#### 设置为已拒绝
```javascript
uni.setStorageSync('engineerVerifyStatus', 'rejected')
uni.setStorageSync('engineerVerifyInfo', {
  realName: '张三',
  phone: '13800138000',
  idCard: '320102199001011234',
  rejectReason: '身份证照片不清晰，请重新上传'
})
console.log('已设置为已拒绝状态')
```

#### 查看当前状态
```javascript
const status = uni.getStorageSync('engineerVerifyStatus')
const info = uni.getStorageSync('engineerVerifyInfo')
console.log('当前认证状态:', status || '未认证')
console.log('认证信息:', info)
```

### 方法三：在代码中添加调试按钮

在工程师首页或其他页面中临时添加调试按钮：

```vue
<template>
  <view class="page">
    <!-- 调试按钮（仅开发环境显示） -->
    <view class="debug-panel" v-if="isDev">
      <button @click="setVerifyStatus(null)">未认证</button>
      <button @click="setVerifyStatus('pending')">审核中</button>
      <button @click="setVerifyStatus('approved')">已认证</button>
      <button @click="setVerifyStatus('rejected')">已拒绝</button>
    </view>
    
    <!-- 其他内容 -->
  </view>
</template>

<script setup>
import { ref } from 'vue'
import { setEngineerVerifyStatus } from '@/utils/engineer-auth.js'

const isDev = ref(true) // 生产环境设置为 false

function setVerifyStatus(status) {
  const mockInfo = {
    realName: '张三',
    phone: '13800138000',
    idCard: '320102199001011234'
  }
  setEngineerVerifyStatus(status, status ? mockInfo : null)
  uni.showToast({
    title: '状态已切换',
    icon: 'success'
  })
}
</script>
```

## 🧪 测试流程示例

### 测试场景1：新用户首次认证

1. 打开测试页面
2. 点击"设置为未认证"按钮
3. 点击"跳转到认证页面"
4. 查看认证表单页面（应该是空白表单）
5. 填写认证信息并提交
6. 状态应该变为"审核中"

### 测试场景2：认证审核中

1. 打开测试页面
2. 点击"设置为审核中"按钮
3. 点击"跳转到认证页面"
4. 查看认证页面（应该显示审核中提示，表单不可编辑）
5. 尝试跳转到需要认证的页面（应该被拦截）

### 测试场景3：认证通过

1. 打开测试页面
2. 点击"设置为已认证"按钮
3. 点击"跳转到工程师首页"
4. 应该可以正常访问所有功能
5. 可以查看和接单

### 测试场景4：认证被拒绝

1. 打开测试页面
2. 点击"设置为已拒绝"按钮
3. 点击"跳转到认证页面"
4. 查看认证页面（应该显示拒绝原因，可以重新编辑提交）

## 📝 注意事项

1. **测试数据持久化**
   - 设置的认证状态会保存在本地存储中
   - 重启微信开发者工具后依然有效
   - 测试完成后记得清除测试数据

2. **清除测试数据**
   ```javascript
   // 在控制台执行
   uni.removeStorageSync('engineerVerifyStatus')
   uni.removeStorageSync('engineerVerifyInfo')
   console.log('测试数据已清除')
   ```

3. **生产环境**
   - 测试页面和调试代码不应该出现在生产环境中
   - 发布前记得移除或隐藏测试功能

4. **真实接口对接**
   - 当前使用的是模拟数据
   - 对接真实接口后，需要调用后端API获取认证状态
   - 参考 `utils/engineer-auth.js` 中的 `fetchAndUpdateEngineerVerifyStatus` 方法

## 🔧 常见问题

### Q1: 为什么切换状态后页面没有更新？

A: 需要重新进入页面或刷新页面才能看到状态变化。可以使用 `uni.reLaunch()` 重新加载页面。

### Q2: 如何在真实环境中测试？

A: 
1. 对接后端认证接口
2. 使用后台管理系统修改认证状态
3. 通过API调用来改变认证状态

### Q3: 测试页面如何隐藏？

A: 
1. 不要在 `pages.json` 中添加到主包
2. 使用条件编译只在开发环境显示
3. 发布前从代码中删除测试页面

## 📚 相关文档

- [工程师认证功能使用说明](./工程师认证功能使用说明.md)
- [工程师认证API文档](../工程师端接口文档.md)
- [认证状态管理](../../store/modules/user.js)
- [认证工具函数](../../utils/engineer-auth.js)

