# 发布工单页面实现说明

## 📱 页面概览

发布工单页面用于用户提交服务需求，创建新的工单。支持选择服务类型、业务领域，填写详细信息，上传图片等。

## 🎨 页面结构

### 1. 顶部导航栏
- 返回按钮（左侧"←"）
- 标题"发布工单"（居中）
- 自定义导航栏

### 2. 表单区域

#### 2.1 服务类型（必填）
- 选择器（picker）
- 选项：
  - 找售后
  - 找售前
  - 找团队

#### 2.2 业务领域（必填）
- 选择器（picker）
- 选项：
  - 充电桩
  - 智慧交管
  - 智慧园区
  - 智慧体育
  - 智慧警务
  - 应急消防
  - 出入口通道
  - AGV机器人
  - 大楼弱电

#### 2.3 工单标题（必填）
- 文本输入框
- 限制50字
- 提示："请简要描述您的需求"

#### 2.4 详细描述（必填）
- 多行文本输入框
- 限制500字
- 提示："请详细描述您的需求、问题现象等"

#### 2.5 上传图片（选填）
- 图片网格展示
- 最多上传6张
- 支持相册选择和拍照
- 图片预览
- 可删除已上传图片
- 提示："最多上传6张图片"

#### 2.6 服务地址（必填）
- 地址选择器
- 提示："请选择服务地址"
- 注：当前为占位功能，V2将支持地图选点

#### 2.7 联系人（必填）
- 文本输入框
- 提示："请输入联系人姓名"

#### 2.8 联系电话（必填）
- 数字输入框
- 限制11位
- 自动验证手机号格式
- 提示："请输入联系电话"

#### 2.9 期望服务时间（必填）
- 日期选择器
- 提示："请选择日期"

#### 2.10 备注（选填）
- 多行文本输入框
- 限制200字
- 提示："其他补充说明（选填）"

### 3. 提交按钮
- 文字："提交工单"
- 样式：
  - 红色渐变背景
  - 圆角按钮
  - 带阴影效果
- 状态：
  - 未填写完整：灰色禁用状态
  - 填写完整：可点击

## 📊 数据结构

### 表单数据
```typescript
{
  serviceType: number,      // 服务类型ID
  domainId: number,         // 业务领域ID
  title: string,            // 工单标题
  description: string,      // 详细描述
  images: string[],         // 图片路径数组
  address: string,          // 服务地址
  contact: string,          // 联系人
  phone: string,            // 联系电话
  serviceDate: string,      // 期望服务时间
  remark: string           // 备注
}
```

### 页面参数
```typescript
{
  service_type?: number,    // 服务类型（从首页跳转时传入）
  domain_id?: number       // 业务领域ID（从首页跳转时传入）
}
```

## 🔄 核心功能

### 1. 页面初始化
```typescript
onMounted(() => {
  // 获取URL参数
  const pages = getCurrentPages()
  const currentPage = pages[pages.length - 1]
  const options = currentPage.$route?.query
  
  // 如果有传入服务类型，自动选中
  if (options.service_type) {
    formData.value.serviceType = parseInt(options.service_type)
  }
  
  // 如果有传入业务领域，自动选中
  if (options.domain_id) {
    formData.value.domainId = parseInt(options.domain_id)
  }
})
```

### 2. 返回上一页
```typescript
function goBack() {
  uni.navigateBack()
}
```

### 3. 服务类型选择
```typescript
function onServiceTypeChange(e) {
  formData.value.serviceType = e.detail.value
}
```

### 4. 业务领域选择
```typescript
function onDomainChange(e) {
  const index = e.detail.value
  formData.value.domainId = businessDomains.value[index].id
}
```

### 5. 图片上传
```typescript
function chooseImage() {
  const remainCount = 6 - formData.value.images.length
  uni.chooseImage({
    count: remainCount,
    sizeType: ['compressed'],
    sourceType: ['album', 'camera'],
    success: (res) => {
      formData.value.images.push(...res.tempFilePaths)
    }
  })
}
```

### 6. 删除图片
```typescript
function deleteImage(index) {
  formData.value.images.splice(index, 1)
}
```

### 7. 选择地址
```typescript
function chooseAddress() {
  // TODO: V2版本将支持地图选点
  uni.showModal({
    title: '提示',
    content: '地址选择功能开发中，V2版本将支持地图选点',
    showCancel: false
  })
}
```

### 8. 日期选择
```typescript
function onDateChange(e) {
  formData.value.serviceDate = e.detail.value
}
```

### 9. 表单验证
```typescript
const canSubmit = computed(() => {
  return formData.value.serviceType &&
         formData.value.domainId &&
         formData.value.title &&
         formData.value.description &&
         formData.value.address &&
         formData.value.contact &&
         formData.value.phone &&
         formData.value.serviceDate
})
```

### 10. 提交工单
```typescript
function handleSubmit() {
  // 1. 检查表单完整性
  if (!canSubmit.value) {
    uni.showToast({
      title: '请完善工单信息',
      icon: 'none'
    })
    return
  }

  // 2. 验证手机号格式
  if (!/^1[3-9]\d{9}$/.test(formData.value.phone)) {
    uni.showToast({
      title: '请输入正确的手机号',
      icon: 'none'
    })
    return
  }

  // 3. 显示确认对话框
  uni.showModal({
    title: '确认提交',
    content: '确认提交工单吗？提交后将为您匹配合适的工程师。',
    success: (res) => {
      if (res.confirm) {
        submitOrder()
      }
    }
  })
}
```

### 11. 提交订单到后端
```typescript
function submitOrder() {
  uni.showLoading({
    title: '提交中...'
  })

  // TODO: 实际应上传图片并调用后端API
  // POST /api/orders/create
  
  // 模拟提交成功
  setTimeout(() => {
    uni.hideLoading()
    uni.showModal({
      title: '提交成功',
      content: '工单已提交，我们将尽快为您匹配工程师。',
      showCancel: false,
      success: () => {
        // 跳转到订单列表
        uni.reLaunch({
          url: '/pages/order/order'
        })
      }
    })
  }, 2000)
}
```

## 🎯 交互逻辑

### 表单填写流程
1. 选择服务类型（或从首页带入）
2. 选择业务领域（或从首页带入）
3. 输入工单标题
4. 输入详细描述
5. 上传图片（可选）
6. 选择服务地址
7. 输入联系人
8. 输入联系电话
9. 选择期望服务时间
10. 输入备注（可选）
11. 点击"提交工单"

### 提交按钮状态
- **禁用状态**（灰色）：
  - 服务类型未选择
  - 业务领域未选择
  - 标题未填写
  - 描述未填写
  - 地址未选择
  - 联系人未填写
  - 联系电话未填写
  - 期望服务时间未选择
  
- **可用状态**（红色渐变）：
  - 所有必填项已填写完整

### 图片上传交互
1. 点击"上传图片"框
2. 选择图片来源（相册/拍照）
3. 选择图片（最多6张）
4. 自动压缩
5. 显示图片预览
6. 可点击"×"删除图片

### 提交确认流程
1. 点击"提交工单"
2. 验证手机号格式
3. 显示确认对话框："确认提交工单吗？"
4. 确认后开始提交
5. 显示加载提示"提交中..."
6. 提交成功后显示："工单已提交，我们将尽快为您匹配工程师"
7. 自动跳转到订单列表页

## 🎨 UI 特点

### 1. 清晰的表单布局
- 白色卡片背景
- 统一的字段标签
- 灰色输入框背景
- 充足的间距

### 2. 选择器样式
- 统一的选择器样式
- 右侧箭头指示
- 未选择时显示占位文字
- 已选择时显示选中内容

### 3. 图片上传区域
- 网格布局
- 图片预览
- 删除按钮（右上角"×"）
- 上传框虚线边框

### 4. 响应式反馈
- 按钮禁用/可用状态
- 加载提示
- 成功提示
- 错误提示

## 🔌 后端接口（待对接）

### 1. 上传图片
```
POST /api/upload/order
Request: FormData (file)
Response: {
  url: string  // 图片URL
}
```

### 2. 创建订单
```
POST /api/orders/create
Request: {
  service_type: number,      // 服务类型
  domain_id: number,         // 业务领域ID
  title: string,             // 标题
  description: string,       // 描述
  images: string[],          // 图片URL数组
  address: string,           // 地址
  contact: string,           // 联系人
  phone: string,             // 电话
  service_date: string,      // 期望服务时间
  remark: string            // 备注
}
Response: {
  order_id: string,          // 订单ID
  order_no: string,          // 订单号
  status: number,            // 订单状态
  message: string           // 提示信息
}
```

## 📱 路由配置

### 页面路径
```
/pages/order/create
```

### 页面配置（pages.json）
```json
{
  "path": "pages/order/create",
  "style": {
    "navigationBarTitleText": "发布工单",
    "navigationStyle": "custom",
    "enablePullDownRefresh": false
  }
}
```

### 跳转方式

#### 从首页服务分类跳转
```typescript
uni.navigateTo({
  url: `/pages/order/create?service_type=${serviceType}`
})
```

#### 从首页业务领域跳转
```typescript
uni.navigateTo({
  url: `/pages/order/create?domain_id=${domainId}`
})
```

#### 从底部悬浮按钮跳转
```typescript
uni.navigateTo({
  url: '/pages/order/create'
})
```

## ✅ 已完成功能

✓ 顶部导航栏（自定义，带返回按钮）  
✓ 服务类型选择器  
✓ 业务领域选择器  
✓ 工单标题输入框（限制50字）  
✓ 详细描述输入框（限制500字）  
✓ 图片上传功能（最多6张）  
✓ 图片预览功能  
✓ 图片删除功能  
✓ 服务地址选择器（占位）  
✓ 联系人输入框  
✓ 联系电话输入框（限制11位）  
✓ 期望服务时间选择器  
✓ 备注输入框（限制200字）  
✓ 提交按钮（动态启用/禁用）  
✓ 手机号格式验证  
✓ 提交确认对话框  
✓ 提交成功提示  
✓ 页面参数接收（service_type, domain_id）  
✓ 自动跳转到订单列表  
✓ 响应式布局

## 🎯 使用说明

### 从首页进入

#### 方式1：点击服务分类
1. 首页点击"找售后"、"找售前"或"找团队"
2. 自动跳转到发布工单页面
3. 服务类型已自动选中

#### 方式2：点击业务领域
1. 首页点击业务领域（如"充电桩"）
2. 自动跳转到发布工单页面
3. 业务领域已自动选中

#### 方式3：点击悬浮按钮
1. 首页底部点击红色"+"按钮
2. 跳转到发布工单页面
3. 需要手动选择服务类型和业务领域

### 填写工单信息
1. 选择或确认服务类型
2. 选择或确认业务领域
3. 输入工单标题（简要描述）
4. 输入详细描述（问题现象、需求等）
5. 上传相关图片（可选，最多6张）
6. 选择服务地址
7. 输入联系人姓名
8. 输入联系电话（11位手机号）
9. 选择期望服务时间
10. 输入备注信息（可选）

### 提交工单
1. 填写完所有必填项
2. 提交按钮变为可点击状态
3. 点击"提交工单"
4. 确认提交信息
5. 等待提交完成
6. 查看提交结果
7. 自动跳转到订单列表

## 💡 注意事项

### 1. 必填项验证
- 服务类型
- 业务领域
- 工单标题
- 详细描述
- 服务地址
- 联系人
- 联系电话
- 期望服务时间

### 2. 手机号验证
- 必须是11位数字
- 以1开头
- 第二位为3-9

### 3. 图片限制
- 最多上传6张
- 自动压缩
- 支持JPG/PNG格式

### 4. 地址选择
- 当前为占位功能
- V2版本将支持地图选点
- 可输入详细地址

## 🚀 待优化功能

### V2版本计划
1. **地图选点**：集成地图组件，支持地图选点和定位
2. **智能推荐**：根据历史地址推荐常用地址
3. **草稿保存**：支持保存草稿，下次继续编辑
4. **模板选择**：预设常用工单模板
5. **语音输入**：支持语音转文字
6. **图片识别**：自动识别图片中的问题类型

---

**注意**：
1. 当前图片上传使用本地路径，实际需对接后端上传接口
2. 提交工单为模拟提交，实际需调用后端API
3. 地址选择功能待完善
4. 需要实现工程师匹配逻辑

