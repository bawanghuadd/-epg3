{"code":"/**\n * 认证工具函数\n * 用于管理用户登录状态和token\n */\nimport { __awaiter } from \"tslib\";\n// 检查是否已登录\nexport function checkLogin() {\n    const token = uni.getStorageSync('token');\n    return !!token;\n}\n// 获取 token\nexport function getToken() {\n    return uni.getStorageSync('token') || '';\n}\n// 获取用户信息\nexport function getUserInfo() {\n    const userInfo = uni.getStorageSync('userInfo');\n    return userInfo || null;\n}\n// 保存登录信息\nexport function saveLoginInfo(token, userInfo) {\n    uni.setStorageSync('token', token);\n    uni.setStorageSync('userInfo', userInfo);\n}\n// 清除登录信息\nexport function clearLoginInfo() {\n    uni.removeStorageSync('token');\n    uni.removeStorageSync('userInfo');\n}\n// 退出登录\nexport function logout() {\n    clearLoginInfo();\n    uni.reLaunch({\n        url: '/pages/index/index'\n    });\n}\n// 验证登录状态，未登录则跳转\nexport function requireLogin() {\n    if (!checkLogin()) {\n        uni.reLaunch({\n            url: '/pages/index/index'\n        });\n        return false;\n    }\n    return true;\n}\n// 微信登录\nexport function wechatLogin() {\n    return __awaiter(this, void 0, void 0, function* () {\n        try {\n            // 1. 获取微信登录凭证\n            const loginRes = yield uni.login({\n                provider: 'weixin',\n                onlyAuthorize: true\n            });\n            uni.__f__('log', 'at utils/auth.ts:81', '微信登录凭证:', loginRes.code);\n            // 2. 将 code 发送到后端换取 token\n            // TODO: 替换为实际的后端接口地址\n            const result = yield requestLogin(loginRes.code);\n            if (result.success) {\n                // 3. 保存登录信息\n                saveLoginInfo(result.data.token, result.data.userInfo);\n            }\n            return result;\n        }\n        catch (error) {\n            uni.__f__('error', 'at utils/auth.ts:94', '微信登录失败:', error);\n            throw error;\n        }\n    });\n}\n// 请求后端登录接口\nfunction requestLogin(code) {\n    return __awaiter(this, void 0, void 0, function* () {\n        try {\n            // TODO: 替换为您的实际后端接口地址\n            const API_BASE_URL = 'https://your-api-domain.com';\n            const res = yield uni.request({\n                url: `${API_BASE_URL}/api/auth/wechat-login`,\n                method: 'POST',\n                data: {\n                    code: code,\n                    platform: 'weixin'\n                },\n                header: {\n                    'Content-Type': 'application/json'\n                }\n            });\n            return res.data;\n        }\n        catch (error) {\n            uni.__f__('error', 'at utils/auth.ts:119', '请求登录接口失败:', error);\n            throw new Error('网络请求失败');\n        }\n    });\n}\n// 获取手机号\nexport function getPhoneNumber(code) {\n    return __awaiter(this, void 0, void 0, function* () {\n        try {\n            // TODO: 替换为您的实际后端接口地址\n            const API_BASE_URL = 'https://your-api-domain.com';\n            const res = yield uni.request({\n                url: `${API_BASE_URL}/api/auth/phone-number`,\n                method: 'POST',\n                data: {\n                    code: code\n                },\n                header: {\n                    'Content-Type': 'application/json',\n                    'Authorization': `Bearer ${getToken()}`\n                }\n            });\n            return res.data;\n        }\n        catch (error) {\n            uni.__f__('error', 'at utils/auth.ts:144', '获取手机号失败:', error);\n            throw new Error('获取手机号失败');\n        }\n    });\n}\n// 更新用户信息\nexport function updateUserInfo(userInfo) {\n    const currentUserInfo = getUserInfo();\n    if (currentUserInfo) {\n        const newUserInfo = Object.assign(Object.assign({}, currentUserInfo), userInfo);\n        uni.setStorageSync('userInfo', newUserInfo);\n    }\n}\n//# sourceMappingURL=/Users/daren1/Desktop/epg3/utils/auth.js.map","references":[],"uniExtApis":[],"map":"{\"version\":3,\"file\":\"auth.js\",\"sourceRoot\":\"\",\"sources\":[\"auth.ts\"],\"names\":[],\"mappings\":\"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\"}"}
