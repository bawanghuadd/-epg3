{"version":3,"file":"auth.js","sources":["utils/auth.js"],"sourcesContent":["/**\n * 认证相关工具函数\n */\n\nimport { STORAGE_KEYS, USER_TYPES, ROUTES } from '../config'\n\n/**\n * 获取 token\n */\nexport function getToken() {\n  return uni.getStorageSync(STORAGE_KEYS.TOKEN)\n}\n\n/**\n * 设置 token\n */\nexport function setToken(token) {\n  uni.setStorageSync(STORAGE_KEYS.TOKEN, token)\n}\n\n/**\n * 移除 token\n */\nexport function removeToken() {\n  uni.removeStorageSync(STORAGE_KEYS.TOKEN)\n}\n\n/**\n * 检查是否已登录\n */\nexport function isLoggedIn() {\n  return !!getToken()\n}\n\n/**\n * 获取用户信息\n */\nexport function getUserInfo() {\n  return uni.getStorageSync(STORAGE_KEYS.USER_INFO) || null\n}\n\n/**\n * 设置用户信息\n */\nexport function setUserInfo(userInfo) {\n  uni.setStorageSync(STORAGE_KEYS.USER_INFO, userInfo)\n}\n\n/**\n * 移除用户信息\n */\nexport function removeUserInfo() {\n  uni.removeStorageSync(STORAGE_KEYS.USER_INFO)\n}\n\n/**\n * 清除所有登录信息\n */\nexport function clearAuth() {\n  removeToken()\n  removeUserInfo()\n}\n\n/**\n * 检查用户类型\n */\nexport function checkUserType(expectedType) {\n  const userInfo = getUserInfo()\n  return userInfo?.user_type === expectedType\n}\n\n/**\n * 是否为客户\n */\nexport function isCustomer() {\n  return checkUserType(USER_TYPES.CUSTOMER)\n}\n\n/**\n * 是否为工程师\n */\nexport function isEngineer() {\n  return checkUserType(USER_TYPES.ENGINEER)\n}\n\n/**\n * 根据用户类型跳转到对应首页\n */\nexport function navigateToHome() {\n  const userInfo = getUserInfo()\n  const homeRoute = userInfo?.user_type === USER_TYPES.ENGINEER \n    ? ROUTES.ENGINEER_HOME \n    : ROUTES.HOME\n  \n  uni.reLaunch({\n    url: homeRoute\n  })\n}\n\n/**\n * 检查登录状态，未登录则跳转到登录页\n */\nexport function requireAuth() {\n  if (!isLoggedIn()) {\n    uni.reLaunch({\n      url: ROUTES.LOGIN\n    })\n    return false\n  }\n  return true\n}\n\n/**\n * 检查用户类型，不匹配则跳转到对应首页\n */\nexport function requireUserType(expectedType) {\n  if (!requireAuth()) {\n    return false\n  }\n  \n  const userInfo = getUserInfo()\n  if (userInfo?.user_type !== expectedType) {\n    navigateToHome()\n    return false\n  }\n  \n  return true\n}\n\n/**\n * 退出登录\n */\nexport function logout() {\n  return new Promise((resolve) => {\n    uni.showModal({\n      title: '提示',\n      content: '确定要退出登录吗？',\n      success: (res) => {\n        if (res.confirm) {\n          clearAuth()\n          uni.reLaunch({\n            url: ROUTES.LOGIN,\n            complete: () => {\n              resolve(true)\n            }\n          })\n        } else {\n          resolve(false)\n        }\n      }\n    })\n  })\n}\n\n"],"names":["uni","STORAGE_KEYS","USER_TYPES","ROUTES"],"mappings":";;;AASO,SAAS,WAAW;AACzB,SAAOA,oBAAI,eAAeC,aAAY,aAAC,KAAK;AAC9C;AAKO,SAAS,SAAS,OAAO;AAC9BD,gBAAAA,MAAI,eAAeC,0BAAa,OAAO,KAAK;AAC9C;AAKO,SAAS,cAAc;AAC5BD,sBAAI,kBAAkBC,aAAY,aAAC,KAAK;AAC1C;AAKO,SAAS,aAAa;AAC3B,SAAO,CAAC,CAAC,SAAU;AACrB;AAKO,SAAS,cAAc;AAC5B,SAAOD,cAAG,MAAC,eAAeC,0BAAa,SAAS,KAAK;AACvD;AAKO,SAAS,YAAY,UAAU;AACpCD,gBAAAA,MAAI,eAAeC,0BAAa,WAAW,QAAQ;AACrD;AAKO,SAAS,iBAAiB;AAC/BD,sBAAI,kBAAkBC,aAAY,aAAC,SAAS;AAC9C;AAKO,SAAS,YAAY;AAC1B,cAAa;AACb,iBAAgB;AAClB;AA2BO,SAAS,iBAAiB;AAC/B,QAAM,WAAW,YAAa;AAC9B,QAAM,aAAY,qCAAU,eAAcC,aAAU,WAAC,WACjDC,aAAAA,OAAO,gBACPA,aAAAA,OAAO;AAEXH,gBAAAA,MAAI,SAAS;AAAA,IACX,KAAK;AAAA,EACT,CAAG;AACH;AAmCO,SAAS,SAAS;AACvB,SAAO,IAAI,QAAQ,CAAC,YAAY;AAC9BA,kBAAAA,MAAI,UAAU;AAAA,MACZ,OAAO;AAAA,MACP,SAAS;AAAA,MACT,SAAS,CAAC,QAAQ;AAChB,YAAI,IAAI,SAAS;AACf,oBAAW;AACXA,wBAAAA,MAAI,SAAS;AAAA,YACX,KAAKG,aAAM,OAAC;AAAA,YACZ,UAAU,MAAM;AACd,sBAAQ,IAAI;AAAA,YACb;AAAA,UACb,CAAW;AAAA,QACX,OAAe;AACL,kBAAQ,KAAK;AAAA,QACd;AAAA,MACF;AAAA,IACP,CAAK;AAAA,EACL,CAAG;AACH;;;;;;;;"}