{"version":3,"file":"auth.js","sources":["utils/auth.ts"],"sourcesContent":["/**\n * 认证工具函数\n * 用于管理用户登录状态和token\n */\n\n// 用户信息接口\nexport interface UserInfo {\n  id: string\n  nickname: string\n  avatar: string\n  phone?: string\n}\n\n// 登录响应接口\nexport interface LoginResponse {\n  success: boolean\n  message: string\n  data: {\n    token: string\n    userInfo: UserInfo\n  }\n}\n\n// 检查是否已登录\nexport function checkLogin(): boolean {\n  const token = uni.getStorageSync('token')\n  return !!token\n}\n\n// 获取 token\nexport function getToken(): string {\n  return uni.getStorageSync('token') || ''\n}\n\n// 获取用户信息\nexport function getUserInfo(): UserInfo | null {\n  const userInfo = uni.getStorageSync('userInfo')\n  return userInfo || null\n}\n\n// 保存登录信息\nexport function saveLoginInfo(token: string, userInfo: UserInfo): void {\n  uni.setStorageSync('token', token)\n  uni.setStorageSync('userInfo', userInfo)\n}\n\n// 清除登录信息\nexport function clearLoginInfo(): void {\n  uni.removeStorageSync('token')\n  uni.removeStorageSync('userInfo')\n}\n\n// 退出登录\nexport function logout(): void {\n  clearLoginInfo()\n  uni.reLaunch({\n    url: '/pages/index/index'\n  })\n}\n\n// 验证登录状态，未登录则跳转\nexport function requireLogin(): boolean {\n  if (!checkLogin()) {\n    uni.reLaunch({\n      url: '/pages/index/index'\n    })\n    return false\n  }\n  return true\n}\n\n// 微信登录\nexport async function wechatLogin(): Promise<LoginResponse> {\n  try {\n    // 1. 获取微信登录凭证\n    const loginRes = await uni.login({\n      provider: 'weixin',\n      onlyAuthorize: true\n    })\n    \n    console.log('微信登录凭证:', loginRes.code)\n    \n    // 2. 将 code 发送到后端换取 token\n    // TODO: 替换为实际的后端接口地址\n    const result = await requestLogin(loginRes.code)\n    \n    if (result.success) {\n      // 3. 保存登录信息\n      saveLoginInfo(result.data.token, result.data.userInfo)\n    }\n    \n    return result\n  } catch (error: any) {\n    console.error('微信登录失败:', error)\n    throw error\n  }\n}\n\n// 请求后端登录接口\nasync function requestLogin(code: string): Promise<LoginResponse> {\n  try {\n    // TODO: 替换为您的实际后端接口地址\n    const API_BASE_URL = 'https://your-api-domain.com'\n    \n    const res = await uni.request({\n      url: `${API_BASE_URL}/api/auth/wechat-login`,\n      method: 'POST',\n      data: {\n        code: code,\n        platform: 'weixin'\n      },\n      header: {\n        'Content-Type': 'application/json'\n      }\n    })\n    \n    return res.data as LoginResponse\n  } catch (error) {\n    console.error('请求登录接口失败:', error)\n    throw new Error('网络请求失败')\n  }\n}\n\n// 获取手机号\nexport async function getPhoneNumber(code: string): Promise<any> {\n  try {\n    // TODO: 替换为您的实际后端接口地址\n    const API_BASE_URL = 'https://your-api-domain.com'\n    \n    const res = await uni.request({\n      url: `${API_BASE_URL}/api/auth/phone-number`,\n      method: 'POST',\n      data: {\n        code: code\n      },\n      header: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${getToken()}`\n      }\n    })\n    \n    return res.data\n  } catch (error) {\n    console.error('获取手机号失败:', error)\n    throw new Error('获取手机号失败')\n  }\n}\n\n// 更新用户信息\nexport function updateUserInfo(userInfo: Partial<UserInfo>): void {\n  const currentUserInfo = getUserInfo()\n  if (currentUserInfo) {\n    const newUserInfo = { ...currentUserInfo, ...userInfo }\n    uni.setStorageSync('userInfo', newUserInfo)\n  }\n}\n"],"names":["uni"],"mappings":";;SAwBgB,aAAU;AACxB,QAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,SAAO,CAAC,CAAC;AACX;SAGgB,WAAQ;AACtB,SAAOA,oBAAI,eAAe,OAAO,KAAK;AACxC;AASgB,SAAA,cAAc,OAAe,UAAkB;AAC7DA,gBAAAA,MAAI,eAAe,SAAS,KAAK;AACjCA,gBAAAA,MAAI,eAAe,YAAY,QAAQ;AACzC;AAgFM,SAAgB,eAAe,MAAY;;AAC/C,QAAI;AAEF,YAAM,eAAe;AAErB,YAAM,MAAM,MAAMA,cAAG,MAAC,QAAQ;AAAA,QAC5B,KAAK,GAAG,YAAY;AAAA,QACpB,QAAQ;AAAA,QACR,MAAM;AAAA,UACJ;AAAA,QACD;AAAA,QACD,QAAQ;AAAA,UACN,gBAAgB;AAAA,UAChB,iBAAiB,UAAU,SAAQ,CAAE;AAAA,QACtC;AAAA,MACF,CAAA;AAED,aAAO,IAAI;AAAA,IACZ,SAAQ,OAAO;AACdA,oBAAA,MAAA,MAAA,SAAA,wBAAc,YAAY,KAAK;AAC/B,YAAM,IAAI,MAAM,SAAS;AAAA,IAC1B;AAAA,GACF;AAAA;;;;"}