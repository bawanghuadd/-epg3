<template>
  <view class="page">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <view class="top-nav">
      <view class="nav-back" @click="goBack">
        <text class="back-icon">â†</text>
      </view>
      <text class="nav-title">è®¢å•è¯¦æƒ…</text>
      <view class="nav-placeholder"></view>
    </view>

    <scroll-view scroll-y class="content-scroll">
      <!-- è®¢å•çŠ¶æ€æµç¨‹ -->
      <view class="status-section">
        <view class="section-title">è®¢å•çŠ¶æ€</view>
        <view class="status-timeline">
          <view 
            class="timeline-item" 
            v-for="(item, index) in statusTimeline" 
            :key="index"
            :class="{ 
              active: item.status <= currentStatus, 
              current: item.status === currentStatus,
              rejected: item.status === 9 && currentStatus === 9
            }"
          >
            <view class="timeline-dot">
              <text class="dot-icon" v-if="item.status < currentStatus">âœ“</text>
              <text class="dot-icon" v-else-if="item.status === currentStatus && currentStatus !== 9">â—</text>
              <text class="dot-icon" v-else-if="item.status === 9 && currentStatus === 9">âœ•</text>
            </view>
            <view class="timeline-content">
              <text class="timeline-title">{{ item.name }}</text>
              <text class="timeline-time" v-if="item.time">{{ item.time }}</text>
              <text class="timeline-desc" v-if="item.desc">{{ item.desc }}</text>
            </view>
            <view class="timeline-line" v-if="index < statusTimeline.length - 1"></view>
          </view>
        </view>

        <!-- å½“å‰çŠ¶æ€æç¤º -->
        <view class="status-tip" :class="'status-tip-' + currentStatus">
          <text class="tip-icon">â„¹ï¸</text>
          <text class="tip-text">{{ currentStatusTip }}</text>
        </view>
      </view>

      <!-- è®¢å•åŸºæœ¬ä¿¡æ¯ -->
      <view class="info-section">
        <view class="section-title">è®¢å•ä¿¡æ¯</view>
        <view class="info-card">
          <view class="info-row">
            <text class="info-label">è®¢å•ç¼–å·</text>
            <text class="info-value">{{ orderInfo.orderNo }}</text>
          </view>
          <view class="info-row">
            <text class="info-label">æœåŠ¡ç±»å‹</text>
            <text class="info-value">{{ orderInfo.serviceType }}</text>
          </view>
          <view class="info-row">
            <text class="info-label">æœåŠ¡æ ‡é¢˜</text>
            <text class="info-value">{{ orderInfo.title }}</text>
          </view>
          <view class="info-row">
            <text class="info-label">éœ€æ±‚æè¿°</text>
            <text class="info-value multi-line">{{ orderInfo.description }}</text>
          </view>
          <view class="info-row">
            <text class="info-label">æœåŠ¡åœ°å€</text>
            <text class="info-value multi-line">{{ orderInfo.address }}</text>
          </view>
          <view class="info-row">
            <text class="info-label">é¢„çº¦æ—¶é—´</text>
            <text class="info-value">{{ orderInfo.appointmentTime }}</text>
          </view>
          <view class="info-row highlight">
            <text class="info-label">è®¢å•é‡‘é¢</text>
            <text class="info-value price">ï¿¥{{ orderInfo.price }}</text>
          </view>
        </view>
      </view>

      <!-- å®¢æˆ·ä¿¡æ¯ -->
      <view class="info-section">
        <view class="section-title">å®¢æˆ·ä¿¡æ¯</view>
        <view class="info-card">
          <view class="info-row">
            <text class="info-label">å®¢æˆ·å§“å</text>
            <text class="info-value">{{ orderInfo.customerName }}</text>
          </view>
          <view class="info-row">
            <text class="info-label">è”ç³»ç”µè¯</text>
            <text class="info-value">{{ orderInfo.customerPhone }}</text>
          </view>
        </view>
      </view>

      <!-- å·¥ç¨‹å¸ˆä¿¡æ¯ (å¾…æ¥å•åæ˜¾ç¤º) -->
      <view class="info-section" v-if="orderInfo.engineerName">
        <view class="section-title">å·¥ç¨‹å¸ˆä¿¡æ¯</view>
        <view class="info-card">
          <view class="engineer-header">
            <image class="engineer-avatar" :src="orderInfo.engineerAvatar || '/static/icons/avatar-default.png'" mode="aspectFill"></image>
            <view class="engineer-info">
              <text class="engineer-name">{{ orderInfo.engineerName }}</text>
              <view class="engineer-tags">
                <text class="tag" v-for="(tag, index) in orderInfo.engineerTags" :key="index">{{ tag }}</text>
              </view>
            </view>
            <button class="contact-btn" @click="contactEngineer">è”ç³»</button>
          </view>
          <view class="info-row">
            <text class="info-label">æ¥å•æ—¶é—´</text>
            <text class="info-value">{{ orderInfo.acceptTime }}</text>
          </view>
          <view class="info-row" v-if="orderInfo.engineerPhone">
            <text class="info-label">è”ç³»ç”µè¯</text>
            <text class="info-value">{{ orderInfo.engineerPhone }}</text>
          </view>
        </view>
      </view>

      <!-- ç­¾çº¦ä¿¡æ¯ (å·²ç­¾çº¦åæ˜¾ç¤º) -->
      <view class="info-section" v-if="currentStatus >= 4">
        <view class="section-title">ç­¾çº¦ä¿¡æ¯</view>
        <view class="info-card">
          <view class="info-row">
            <text class="info-label">ç­¾çº¦æ—¶é—´</text>
            <text class="info-value">{{ orderInfo.signTime }}</text>
          </view>
          <view class="info-row">
            <text class="info-label">æœåŠ¡è´¹ç”¨</text>
            <text class="info-value">ï¿¥{{ orderInfo.serviceFee }}</text>
          </view>
          <view class="info-row">
            <text class="info-label">æœåŠ¡æ—¶é—´</text>
            <text class="info-value">{{ orderInfo.serviceTime }}</text>
          </view>
          <view class="contract-file" @click="viewContract">
            <text class="file-icon">ğŸ“„</text>
            <text class="file-name">ç”µå­åˆåŒ.pdf</text>
            <text class="file-action">æŸ¥çœ‹</text>
          </view>
        </view>
      </view>

      <!-- æ²Ÿé€šè®°å½• (æ²Ÿé€šä¸­åæ˜¾ç¤º) -->
      <view class="info-section" v-if="communicationLogs.length > 0">
        <view class="section-title">æ²Ÿé€šè®°å½•</view>
        <view class="info-card">
          <view class="comm-item" v-for="(log, index) in communicationLogs" :key="index">
            <view class="comm-header">
              <text class="comm-user">{{ log.userName }}</text>
              <text class="comm-time">{{ log.time }}</text>
            </view>
            <text class="comm-content">{{ log.content }}</text>
          </view>
          <button class="more-btn" @click="viewAllCommunication">æŸ¥çœ‹å…¨éƒ¨æ²Ÿé€šè®°å½•</button>
        </view>
      </view>

      <!-- æ“ä½œæ—¥å¿— -->
      <view class="info-section">
        <view class="section-title">æ“ä½œæ—¥å¿—</view>
        <view class="info-card">
          <view class="log-item" v-for="(log, index) in operationLogs" :key="index">
            <view class="log-dot"></view>
            <view class="log-content">
              <text class="log-text">{{ log.content }}</text>
              <text class="log-time">{{ log.time }}</text>
              <text class="log-operator" v-if="log.operator">æ“ä½œäºº: {{ log.operator }}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- åº•éƒ¨æ“ä½œæŒ‰é’®åŒºåŸŸå ä½ -->
      <view style="height: 200rpx;"></view>
    </scroll-view>

    <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
    <view class="bottom-actions" v-if="actionButtons.length > 0">
      <button 
        class="action-button" 
        :class="btn.type"
        v-for="(btn, index) in actionButtons" 
        :key="index"
        @click="handleAction(btn.action)"
      >
        {{ btn.text }}
      </button>
    </view>
  </view>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'

// è®¢å•ID
const orderId = ref('')

// å½“å‰è®¢å•çŠ¶æ€
const currentStatus = ref(3) // ç¤ºä¾‹: 3=å·²æ¥å•(å¾…ç­¾çº¦)

// è®¢å•åŸºæœ¬ä¿¡æ¯
const orderInfo = ref({
  orderNo: 'ORD202501190002',
  serviceType: 'å”®å‰æœåŠ¡',
  title: 'å……ç”µæ¡©å®‰è£…æ–¹æ¡ˆå’¨è¯¢',
  description: 'éœ€è¦ä¸“ä¸šå·¥ç¨‹å¸ˆè¯„ä¼°ç°åœºï¼Œæä¾›å……ç”µæ¡©å®‰è£…æ–¹æ¡ˆ',
  address: 'æ‰¬å·å¸‚å¹¿é™µåŒºå•†ä¸šå¹¿åœºåœè½¦åœºBåŒº',
  appointmentTime: '2025-01-20 14:00',
  price: '1200.00',
  customerName: 'å¼ å…ˆç”Ÿ',
  customerPhone: '138****5678',
  engineerName: 'æå·¥',
  engineerAvatar: '',
  engineerTags: ['å®¶ç”µç»´ä¿®', 'å¼±ç”µå·¥ç¨‹', '5å¹´ç»éªŒ'],
  engineerPhone: '139****1234',
  acceptTime: '2025-01-19 10:30',
  signTime: '',
  serviceFee: '',
  serviceTime: '',
  createTime: '2025-01-18 15:20'
})

// è®¢å•çŠ¶æ€æ—¶é—´è½´
const statusTimeline = computed(() => {
  const timeline = [
    {
      status: 1,
      name: 'å¾…ä»˜æ¬¾',
      time: orderInfo.value.createTime,
      desc: 'å®¢æˆ·å‘èµ·è®¢å•'
    },
    {
      status: 2,
      name: 'å·²ä»˜æ¬¾(å¾…æ¥å•)',
      time: currentStatus.value >= 2 ? '2025-01-19 09:00' : '',
      desc: currentStatus.value >= 2 ? 'ç­‰å¾…å·¥ç¨‹å¸ˆæ¥å•' : ''
    },
    {
      status: 3,
      name: 'å·²æ¥å•(å¾…ç­¾çº¦)',
      time: currentStatus.value >= 3 ? orderInfo.value.acceptTime : '',
      desc: currentStatus.value >= 3 ? `å·¥ç¨‹å¸ˆ${orderInfo.value.engineerName}å·²æ¥å•` : ''
    },
    {
      status: 4,
      name: 'å·²ç­¾çº¦(å¾…æœåŠ¡)',
      time: currentStatus.value >= 4 ? orderInfo.value.signTime : '',
      desc: currentStatus.value >= 4 ? 'åŒæ–¹å·²ç­¾è®¢æœåŠ¡åˆåŒ' : ''
    },
    {
      status: 5,
      name: 'æœåŠ¡ä¸­',
      time: currentStatus.value >= 5 ? '2025-01-20 14:30' : '',
      desc: currentStatus.value >= 5 ? 'å·¥ç¨‹å¸ˆæ­£åœ¨æä¾›æœåŠ¡' : ''
    },
    {
      status: 6,
      name: 'å¾…ç¡®è®¤',
      time: currentStatus.value >= 6 ? '2025-01-20 18:00' : '',
      desc: currentStatus.value >= 6 ? 'ç­‰å¾…å®¢æˆ·ç¡®è®¤å®Œæˆ' : ''
    },
    {
      status: 7,
      name: 'å·²å®Œæˆ',
      time: currentStatus.value >= 7 ? '2025-01-20 19:00' : '',
      desc: currentStatus.value >= 7 ? 'è®¢å•å·²å®Œæˆ' : ''
    }
  ]

  // å¦‚æœè®¢å•è¢«é©³å›,æ˜¾ç¤ºé©³å›çŠ¶æ€
  if (currentStatus.value === 9) {
    return [
      ...timeline.slice(0, 3),
      {
        status: 9,
        name: 'å·²é©³å›',
        time: '2025-01-19 16:00',
        desc: 'å®¡æ ¸ä¸é€šè¿‡,åŸå› : å·¥ç¨‹å¸ˆèµ„è´¨ä¸ç¬¦åˆè¦æ±‚'
      }
    ]
  }

  return timeline
})

// å½“å‰çŠ¶æ€æç¤º
const currentStatusTip = computed(() => {
  const tips: any = {
    1: 'è¯·å°½å¿«å®Œæˆæ”¯ä»˜,è®¢å•å°†åœ¨30åˆ†é’Ÿåè‡ªåŠ¨å–æ¶ˆ',
    2: 'è®¢å•å·²è¿›å…¥å·¥ç¨‹å¸ˆæ¥å•æ± ,å¹³å°æ­£åœ¨ä¸ºæ‚¨åŒ¹é…åˆé€‚çš„å·¥ç¨‹å¸ˆ',
    3: 'å·¥ç¨‹å¸ˆå·²æ¥å•,è¯·ä¸å·¥ç¨‹å¸ˆæ²Ÿé€šç¡®è®¤æœåŠ¡ç»†èŠ‚åç­¾è®¢åˆåŒ',
    4: 'åˆåŒå·²ç­¾è®¢,å·¥ç¨‹å¸ˆå°†æŒ‰çº¦å®šæ—¶é—´æä¾›æœåŠ¡',
    5: 'å·¥ç¨‹å¸ˆæ­£åœ¨ä¸ºæ‚¨æä¾›æœåŠ¡,å¦‚æœ‰é—®é¢˜è¯·åŠæ—¶æ²Ÿé€š',
    6: 'æœåŠ¡å·²å®Œæˆ,è¯·ç¡®è®¤æœåŠ¡è´¨é‡åç‚¹å‡»"ç¡®è®¤å®Œæˆ"',
    7: 'è®¢å•å·²å®Œæˆ,æ„Ÿè°¢æ‚¨çš„ä½¿ç”¨',
    8: 'å”®åå¤„ç†ä¸­,å®¢æœå°†å°½å¿«ä¸ºæ‚¨å¤„ç†',
    9: 'è®¢å•å®¡æ ¸æœªé€šè¿‡,æ‚¨å¯ä»¥æŸ¥çœ‹é©³å›åŸå› å¹¶é‡æ–°åå•†'
  }
  return tips[currentStatus.value] || ''
})

// æ²Ÿé€šè®°å½•
const communicationLogs = ref([
  {
    userName: 'æå·¥',
    time: '2025-01-19 10:35',
    content: 'æ‚¨å¥½,æˆ‘å·²æ¥å•,æ˜å¤©ä¸‹åˆ2ç‚¹å¯ä»¥åˆ°ç°åœºå‹˜å¯Ÿ,æ‚¨çœ‹æ–¹ä¾¿å—?'
  },
  {
    userName: 'æˆ‘',
    time: '2025-01-19 10:40',
    content: 'å¯ä»¥çš„,æ˜å¤©ä¸‹åˆ2ç‚¹è§ã€‚'
  },
  {
    userName: 'æå·¥',
    time: '2025-01-19 10:42',
    content: 'å¥½çš„,æˆ‘ä¼šå‡†æ—¶åˆ°è¾¾,è¯·ä¿æŒç”µè¯ç•…é€šã€‚'
  }
])

// æ“ä½œæ—¥å¿—
const operationLogs = ref([
  {
    content: 'å·¥ç¨‹å¸ˆæå·¥æ¥å•',
    time: '2025-01-19 10:30',
    operator: 'æå·¥'
  },
  {
    content: 'è®¢å•æ”¯ä»˜æˆåŠŸ',
    time: '2025-01-19 09:00',
    operator: 'å¼ å…ˆç”Ÿ'
  },
  {
    content: 'è®¢å•åˆ›å»ºæˆåŠŸ',
    time: '2025-01-18 15:20',
    operator: 'å¼ å…ˆç”Ÿ'
  }
])

// åº•éƒ¨æ“ä½œæŒ‰é’®
const actionButtons = computed(() => {
  const buttons: any = {
    1: [
      { text: 'å–æ¶ˆè®¢å•', type: 'secondary', action: 'cancel' },
      { text: 'ç«‹å³æ”¯ä»˜', type: 'primary', action: 'pay' }
    ],
    2: [
      { text: 'å–æ¶ˆè®¢å•', type: 'secondary', action: 'cancel' },
      { text: 'æŸ¥çœ‹æ¥å•æ± ', type: 'default', action: 'viewPool' }
    ],
    3: [
      { text: 'è”ç³»å·¥ç¨‹å¸ˆ', type: 'secondary', action: 'contact' },
      { text: 'ç­¾è®¢åˆåŒ', type: 'primary', action: 'sign' }
    ],
    4: [
      { text: 'è”ç³»å¹³å°å–æ¶ˆ', type: 'secondary', action: 'contactPlatform' },
      { text: 'è”ç³»å·¥ç¨‹å¸ˆ', type: 'default', action: 'contact' }
    ],
    5: [
      { text: 'æŠ•è¯‰/ä¸¾æŠ¥', type: 'secondary', action: 'report' },
      { text: 'è”ç³»å·¥ç¨‹å¸ˆ', type: 'default', action: 'contact' }
    ],
    6: [
      { text: 'ç”³è¯·å”®å', type: 'secondary', action: 'afterSale' },
      { text: 'ç¡®è®¤å®Œæˆ', type: 'primary', action: 'confirm' }
    ],
    7: [
      { text: 'ç”³è¯·å”®å', type: 'secondary', action: 'afterSale' },
      { text: 'å†æ¥ä¸€å•', type: 'primary', action: 'reorder' }
    ],
    8: [
      { text: 'æŸ¥çœ‹å”®åè¿›åº¦', type: 'default', action: 'viewAfterSale' }
    ],
    9: [
      { text: 'åˆ é™¤è®¢å•', type: 'secondary', action: 'delete' },
      { text: 'é‡æ–°åå•†', type: 'primary', action: 'renegotiate' }
    ]
  }
  return buttons[currentStatus.value] || []
})

onMounted(() => {
  // è·å–é¡µé¢å‚æ•°
  const pages = getCurrentPages()
  const currentPage = pages[pages.length - 1] as any
  const options = currentPage.options || {}
  
  orderId.value = options.id || ''
  
  // åŠ è½½è®¢å•è¯¦æƒ…
  loadOrderDetail()
})

// åŠ è½½è®¢å•è¯¦æƒ…
function loadOrderDetail() {
  // TODO: ä»åç«¯APIè·å–è®¢å•è¯¦æƒ…
  // GET /api/orders/{id}
  console.log('åŠ è½½è®¢å•è¯¦æƒ…:', orderId.value)
}

// è¿”å›
function goBack() {
  uni.navigateBack()
}

// è”ç³»å·¥ç¨‹å¸ˆ
function contactEngineer() {
  uni.showToast({
    title: 'æ­£åœ¨è¿›å…¥ç¾¤èŠ...',
    icon: 'loading'
  })
  
  setTimeout(() => {
    uni.showToast({
      title: 'IMåŠŸèƒ½å¼€å‘ä¸­',
      icon: 'none'
    })
  }, 1000)
}

// æŸ¥çœ‹åˆåŒ
function viewContract() {
  uni.showToast({
    title: 'æŸ¥çœ‹ç”µå­åˆåŒ',
    icon: 'none'
  })
}

// æŸ¥çœ‹å…¨éƒ¨æ²Ÿé€šè®°å½•
function viewAllCommunication() {
  uni.showToast({
    title: 'æŸ¥çœ‹å…¨éƒ¨æ²Ÿé€šè®°å½•',
    icon: 'none'
  })
}

// å¤„ç†æ“ä½œæŒ‰é’®ç‚¹å‡»
function handleAction(action: string) {
  const actions: any = {
    pay: () => {
      uni.showModal({
        title: 'ç¡®è®¤æ”¯ä»˜',
        content: `è®¢å•é‡‘é¢ï¼šï¿¥${orderInfo.value.price}`,
        confirmText: 'ç¡®è®¤æ”¯ä»˜',
        success: (res) => {
          if (res.confirm) {
            uni.showToast({ title: 'æ”¯ä»˜åŠŸèƒ½å¼€å‘ä¸­', icon: 'none' })
          }
        }
      })
    },
    cancel: () => {
      uni.showModal({
        title: 'å–æ¶ˆè®¢å•',
        content: 'ç¡®å®šè¦å–æ¶ˆè¿™ä¸ªè®¢å•å—ï¼Ÿ',
        success: (res) => {
          if (res.confirm) {
            uni.showToast({ title: 'è®¢å•å·²å–æ¶ˆ', icon: 'success' })
            setTimeout(() => uni.navigateBack(), 1500)
          }
        }
      })
    },
    contact: () => contactEngineer(),
    sign: () => {
      uni.showModal({
        title: 'ç­¾è®¢åˆåŒ',
        content: 'è¯·ç¡®è®¤ä¸å·¥ç¨‹å¸ˆç­¾è®¢æœåŠ¡åˆåŒ',
        confirmText: 'ç¡®è®¤ç­¾çº¦',
        success: (res) => {
          if (res.confirm) {
            uni.showToast({ title: 'ç­¾çº¦åŠŸèƒ½å¼€å‘ä¸­', icon: 'none' })
          }
        }
      })
    },
    contactPlatform: () => {
      uni.showModal({
        title: 'è”ç³»å¹³å°',
        content: 'è®¢å•å·²ç­¾çº¦ï¼Œéœ€è¦è”ç³»å¹³å°å®¢æœååŠ©å–æ¶ˆ',
        confirmText: 'è”ç³»å®¢æœ',
        success: (res) => {
          if (res.confirm) {
            uni.showToast({ title: 'å®¢æœåŠŸèƒ½å¼€å‘ä¸­', icon: 'none' })
          }
        }
      })
    },
    report: () => {
      uni.showActionSheet({
        itemList: ['æŠ•è¯‰å·¥ç¨‹å¸ˆ', 'ä¸¾æŠ¥è®¢å•', 'å–æ¶ˆ'],
        success: (res) => {
          if (res.tapIndex < 2) {
            uni.showToast({ title: 'æŠ•è¯‰ä¸¾æŠ¥åŠŸèƒ½å¼€å‘ä¸­', icon: 'none' })
          }
        }
      })
    },
    confirm: () => {
      uni.showModal({
        title: 'ç¡®è®¤å®Œæˆ',
        content: 'ç¡®è®¤å·¥ç¨‹å¸ˆå·²å®ŒæˆæœåŠ¡ï¼Ÿç¡®è®¤åå°†æ— æ³•æ’¤é”€',
        confirmText: 'ç¡®è®¤å®Œæˆ',
        success: (res) => {
          if (res.confirm) {
            uni.showToast({ title: 'è®¢å•å·²å®Œæˆ', icon: 'success' })
            setTimeout(() => uni.navigateBack(), 1500)
          }
        }
      })
    },
    afterSale: () => {
      uni.showActionSheet({
        itemList: ['ç”³è¯·é€€æ¬¾', 'ç”³è¯·è¿”å·¥', 'è´¨é‡é—®é¢˜', 'å–æ¶ˆ'],
        success: (res) => {
          if (res.tapIndex < 3) {
            uni.showToast({ title: 'å”®ååŠŸèƒ½å¼€å‘ä¸­', icon: 'none' })
          }
        }
      })
    },
    reorder: () => {
      uni.showModal({
        title: 'å†æ¥ä¸€å•',
        content: 'æ ¹æ®æ­¤è®¢å•ä¿¡æ¯åˆ›å»ºæ–°è®¢å•ï¼Ÿ',
        success: (res) => {
          if (res.confirm) {
            uni.navigateTo({ url: `/pages/order/create?copyFrom=${orderId.value}` })
          }
        }
      })
    },
    delete: () => {
      uni.showModal({
        title: 'åˆ é™¤è®¢å•',
        content: 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè®¢å•å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤',
        confirmText: 'åˆ é™¤',
        confirmColor: '#E53935',
        success: (res) => {
          if (res.confirm) {
            uni.showToast({ title: 'è®¢å•å·²åˆ é™¤', icon: 'success' })
            setTimeout(() => uni.navigateBack(), 1500)
          }
        }
      })
    },
    renegotiate: () => {
      uni.showToast({ title: 'é‡æ–°åå•†åŠŸèƒ½å¼€å‘ä¸­', icon: 'none' })
    },
    viewPool: () => {
      uni.showToast({ title: 'æŸ¥çœ‹æ¥å•æ± åŠŸèƒ½å¼€å‘ä¸­', icon: 'none' })
    },
    viewAfterSale: () => {
      uni.showToast({ title: 'æŸ¥çœ‹å”®åè¿›åº¦åŠŸèƒ½å¼€å‘ä¸­', icon: 'none' })
    }
  }
  
  if (actions[action]) {
    actions[action]()
  }
}
</script>

<style scoped lang="scss">
.page {
  min-height: 100vh;
  background-color: #F5F5F5;
  padding-bottom: 160rpx;
}

/* é¡¶éƒ¨å¯¼èˆª */
.top-nav {
  background-color: #fff;
  padding: 32rpx 32rpx;
  padding-top: calc(64rpx + env(safe-area-inset-top));
  padding-bottom: 24rpx;
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1rpx solid #f0f0f0;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  width: 100%;
  z-index: 1000;
}

.nav-back {
  width: 60rpx;
}

.back-icon {
  font-size: 44rpx;
  color: #333;
  font-weight: 600;
}

.nav-title {
  font-size: 36rpx;
  font-weight: 700;
  color: #333;
  flex: 1;
  text-align: center;
}

.nav-placeholder {
  width: 60rpx;
}

.content-scroll {
  padding: 24rpx 32rpx;
  padding-top: calc(164rpx + env(safe-area-inset-top));
}

/* è®¢å•çŠ¶æ€æµç¨‹ */
.status-section {
  background-color: #fff;
  border-radius: 16rpx;
  padding: 32rpx;
  margin-bottom: 24rpx;
}

.section-title {
  font-size: 32rpx;
  font-weight: 700;
  color: #333;
  margin-bottom: 24rpx;
}

.status-timeline {
  position: relative;
}

.timeline-item {
  display: flex;
  flex-direction: row;
  position: relative;
  padding-bottom: 40rpx;
}

.timeline-item:last-child {
  padding-bottom: 0;
}

.timeline-dot {
  width: 48rpx;
  height: 48rpx;
  border-radius: 50%;
  background-color: #E0E0E0;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  position: relative;
  z-index: 2;
}

.timeline-item.active .timeline-dot {
  background-color: #E53935;
}

.timeline-item.current .timeline-dot {
  background-color: #E53935;
  box-shadow: 0 0 0 8rpx rgba(229, 57, 53, 0.2);
}

.timeline-item.rejected .timeline-dot {
  background-color: #999;
}

.dot-icon {
  color: #fff;
  font-size: 24rpx;
  font-weight: 700;
}

.timeline-content {
  flex: 1;
  margin-left: 24rpx;
  display: flex;
  flex-direction: column;
  gap: 8rpx;
}

.timeline-title {
  font-size: 28rpx;
  font-weight: 600;
  color: #666;
}

.timeline-item.active .timeline-title {
  color: #333;
}

.timeline-item.current .timeline-title {
  color: #E53935;
}

.timeline-time {
  font-size: 24rpx;
  color: #999;
}

.timeline-desc {
  font-size: 24rpx;
  color: #999;
}

.timeline-line {
  position: absolute;
  left: 24rpx;
  top: 48rpx;
  bottom: 0;
  width: 2rpx;
  background-color: #E0E0E0;
  z-index: 1;
}

.timeline-item.active .timeline-line {
  background-color: #E53935;
}

/* çŠ¶æ€æç¤º */
.status-tip {
  margin-top: 24rpx;
  padding: 20rpx;
  border-radius: 12rpx;
  background-color: #F5F5F5;
  display: flex;
  flex-direction: row;
  align-items: flex-start;
  gap: 12rpx;
}

.status-tip-1,
.status-tip-2 {
  background-color: #EFF6FF;
}

.status-tip-3,
.status-tip-4 {
  background-color: #ECFDF5;
}

.status-tip-5,
.status-tip-6 {
  background-color: #FFFBEB;
}

.status-tip-7 {
  background-color: #ECFDF5;
}

.status-tip-9 {
  background-color: #FEF2F2;
}

.tip-icon {
  font-size: 28rpx;
}

.tip-text {
  flex: 1;
  font-size: 26rpx;
  color: #666;
  line-height: 1.6;
}

/* ä¿¡æ¯å¡ç‰‡ */
.info-section {
  background-color: #fff;
  border-radius: 16rpx;
  padding: 32rpx;
  margin-bottom: 24rpx;
}

.info-card {
  display: flex;
  flex-direction: column;
  gap: 24rpx;
}

.info-row {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: flex-start;
}

.info-row.highlight {
  padding: 20rpx;
  background-color: #FFF3E6;
  border-radius: 12rpx;
  margin-top: 8rpx;
}

.info-label {
  font-size: 26rpx;
  color: #999;
  min-width: 140rpx;
}

.info-value {
  flex: 1;
  font-size: 28rpx;
  color: #333;
  text-align: right;
  word-break: break-all;
}

.info-value.multi-line {
  text-align: left;
  margin-left: 20rpx;
}

.info-value.price {
  font-size: 36rpx;
  font-weight: 700;
  color: #E53935;
}

/* å·¥ç¨‹å¸ˆä¿¡æ¯ */
.engineer-header {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 20rpx;
  padding-bottom: 24rpx;
  border-bottom: 1rpx solid #f0f0f0;
  margin-bottom: 24rpx;
}

.engineer-avatar {
  width: 96rpx;
  height: 96rpx;
  border-radius: 50%;
  background-color: #f5f5f5;
}

.engineer-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 12rpx;
}

.engineer-name {
  font-size: 32rpx;
  font-weight: 700;
  color: #333;
}

.engineer-tags {
  display: flex;
  flex-direction: row;
  gap: 12rpx;
  flex-wrap: wrap;
}

.tag {
  font-size: 22rpx;
  color: #E53935;
  background-color: #FFEBEE;
  padding: 6rpx 16rpx;
  border-radius: 8rpx;
}

.contact-btn {
  padding: 16rpx 32rpx;
  background-color: #E53935;
  color: #fff;
  border: none;
  border-radius: 40rpx;
  font-size: 26rpx;
  line-height: 1;
}

/* åˆåŒæ–‡ä»¶ */
.contract-file {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 16rpx;
  padding: 24rpx;
  background-color: #F5F5F5;
  border-radius: 12rpx;
  margin-top: 8rpx;
}

.file-icon {
  font-size: 40rpx;
}

.file-name {
  flex: 1;
  font-size: 28rpx;
  color: #333;
}

.file-action {
  font-size: 26rpx;
  color: #E53935;
}

/* æ²Ÿé€šè®°å½• */
.comm-item {
  padding: 20rpx 0;
  border-bottom: 1rpx solid #f0f0f0;
}

.comm-item:last-child {
  border-bottom: none;
}

.comm-header {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12rpx;
}

.comm-user {
  font-size: 26rpx;
  font-weight: 600;
  color: #333;
}

.comm-time {
  font-size: 24rpx;
  color: #999;
}

.comm-content {
  font-size: 26rpx;
  color: #666;
  line-height: 1.6;
}

.more-btn {
  width: 100%;
  margin-top: 16rpx;
  padding: 20rpx;
  background-color: #F5F5F5;
  color: #666;
  border: none;
  border-radius: 12rpx;
  font-size: 26rpx;
  line-height: 1;
}

/* æ“ä½œæ—¥å¿— */
.log-item {
  display: flex;
  flex-direction: row;
  gap: 20rpx;
  padding: 20rpx 0;
  position: relative;
}

.log-item:not(:last-child)::after {
  content: '';
  position: absolute;
  left: 8rpx;
  top: 40rpx;
  bottom: -20rpx;
  width: 2rpx;
  background-color: #E0E0E0;
}

.log-dot {
  width: 16rpx;
  height: 16rpx;
  border-radius: 50%;
  background-color: #E53935;
  margin-top: 8rpx;
  flex-shrink: 0;
}

.log-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 8rpx;
}

.log-text {
  font-size: 28rpx;
  color: #333;
}

.log-time {
  font-size: 24rpx;
  color: #999;
}

.log-operator {
  font-size: 24rpx;
  color: #999;
}

/* åº•éƒ¨æ“ä½œæŒ‰é’® */
.bottom-actions {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background-color: #fff;
  padding: 24rpx 32rpx;
  padding-bottom: calc(24rpx + env(safe-area-inset-bottom));
  border-top: 1rpx solid #f0f0f0;
  display: flex;
  flex-direction: row;
  gap: 20rpx;
  box-shadow: 0 -2rpx 12rpx rgba(0, 0, 0, 0.06);
}

.action-button {
  flex: 1;
  padding: 24rpx;
  border-radius: 40rpx;
  font-size: 28rpx;
  font-weight: 600;
  border: 1rpx solid #E0E0E0;
  background-color: #fff;
  color: #666;
  line-height: 1;
}

.action-button.secondary {
  border-color: #E0E0E0;
  background-color: #fff;
  color: #666;
}

.action-button.primary {
  border-color: #E53935;
  background-color: #E53935;
  color: #fff;
}

.action-button.default {
  border-color: #E53935;
  background-color: #fff;
  color: #E53935;
}
</style>




