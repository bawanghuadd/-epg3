# 域名校验问题解决方案

## 错误信息
```
request:fail url not in domain list
```

## 问题原因
微信小程序要求所有网络请求的域名必须在合法域名列表中，开发阶段需要关闭域名校验。

## 已完成的配置

### ✅ 1. manifest.json 配置
```json
"mp-weixin": {
  "appid": "wx7b965f99d207b7f3",
  "setting": {
    "urlCheck": false  // ✅ 已配置
  }
}
```

### ✅ 2. project.private.config.json 配置
```json
{
  "setting": {
    "urlCheck": false  // ✅ 已配置
  }
}
```

## 解决步骤（按顺序尝试）

### 步骤 1：重启微信开发者工具
1. **完全关闭**微信开发者工具（不是最小化）
2. 重新打开微信开发者工具
3. 重新导入项目
4. 重新编译

### 步骤 2：在微信开发者工具中手动设置（重要！）
1. 打开微信开发者工具
2. 点击右上角的 **"详情"** 按钮
3. 选择 **"本地设置"** 标签页
4. 勾选以下选项：
   - ✅ **不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书**
   - ✅ **不校验 TLS 版本以及 HTTPS 证书**
5. 点击 **"确定"** 保存
6. **重新编译**项目

### 步骤 3：清理编译缓存
1. 关闭微信开发者工具
2. 删除项目根目录下的 `unpackage` 文件夹
3. 重新打开项目
4. 重新编译

### 步骤 4：检查项目设置
在微信开发者工具中：
1. 点击 **"项目"** → **"项目设置"**
2. 确认 **"不校验合法域名"** 选项已勾选
3. 保存并重新编译

### 步骤 5：如果使用 uni-app-x，检查编译设置
1. 在 HBuilderX 中（如果使用）
2. 点击 **"运行"** → **"运行到小程序模拟器"** → **"微信开发者工具"**
3. 确保编译设置正确

## 临时解决方案（开发环境）

如果以上方法都不行，可以临时修改 API 地址使用本地代理：

### 方案 A：使用 localhost
修改 `config/index.js`：
```javascript
export const API_CONFIG = {
  baseURL: 'http://localhost:8080',  // 使用本地代理
  timeout: 10000,
  uploadURL: 'http://localhost:8080/upload'
}
```

### 方案 B：使用 127.0.0.1
```javascript
export const API_CONFIG = {
  baseURL: 'http://127.0.0.1:8080',
  timeout: 10000,
  uploadURL: 'http://127.0.0.1:8080/upload'
}
```

### 方案 C：配置代理服务器
在微信开发者工具中：
1. 点击 **"详情"** → **"本地设置"**
2. 启用 **"代理设置"**
3. 配置代理服务器地址

## 生产环境配置（上线前必须）

⚠️ **重要：** 项目上线前，必须在微信公众平台配置合法域名：

1. 登录 [微信公众平台](https://mp.weixin.qq.com/)
2. 进入 **"开发"** → **"开发管理"** → **"开发设置"**
3. 在 **"服务器域名"** 中添加：
   - **request合法域名**：`https://your-api-domain.com`
   - **uploadFile合法域名**：`https://your-api-domain.com`
   - **downloadFile合法域名**：`https://your-api-domain.com`
4. 保存配置（需要管理员扫码确认）

**注意：**
- 生产环境必须使用 HTTPS
- 域名必须备案（如果是国内服务器）
- 配置后需要等待几分钟生效

## 验证配置是否生效

在控制台查看网络请求：
1. 打开微信开发者工具的控制台
2. 查看 Network 标签
3. 发起一个网络请求
4. 如果请求成功，说明配置生效

## 常见问题

### Q1: 修改配置后仍然报错？
**A:** 必须重启微信开发者工具才能生效。

### Q2: 为什么本地 IP 地址不能使用？
**A:** 微信小程序对域名有严格限制，建议使用 localhost 或配置代理。

### Q3: 开发环境可以使用 HTTP 吗？
**A:** 可以，但需要在开发者工具中关闭域名校验。

### Q4: 生产环境必须使用 HTTPS 吗？
**A:** 是的，微信小程序要求生产环境必须使用 HTTPS。

## 当前 API 配置

```javascript
// config/index.js
export const API_CONFIG = {
  baseURL: 'http://192.168.31.61',  // 本地开发服务器
  timeout: 10000,
  uploadURL: 'http://192.168.31.61/upload'
}
```

## 推荐操作

1. ✅ **立即执行：** 在微信开发者工具中手动勾选"不校验合法域名"
2. ✅ **重启工具：** 完全关闭并重新打开微信开发者工具
3. ✅ **清理缓存：** 删除 `unpackage` 文件夹
4. ✅ **重新编译：** 重新编译项目

如果问题仍然存在，请检查：
- 微信开发者工具版本是否最新
- 项目编译类型是否正确（uni-app-x）
- 网络连接是否正常

